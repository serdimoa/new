{% extends "base.html" %}
{% block title %}Реестр контрактов {% endblock %}
{% block nav %}

<ul class="nav nav-pills nav-stacked custom-nav">
    <li class="menu-list"><a href=""><i class="fa fa-home"></i> <span>Реестр детей</span></a>
        <ul class="sub-menu-list">
            <li ><a href="index.php?np=good"><i class="fa fa-search"></i> <span>Обзор</span></a></li>
            <li><a href="index.php?np=children_new"><i class="fa fa-plus"></i> <span>Добавить ребенка</span></a></li>
        </ul>
    </li>
    <li><a href="index.php?np=request.html"><i class="fa fa-envelope"></i> <span>Реестр заявок</span></a></li>
    <li class="menu-list  nav-active "><a href=""><i class="fa fa-home"></i> <span>Контракты</span></a>
        <ul class="sub-menu-list">
            <li class="active"> <a href="index.php?np=kontrakt"><i class="fa fa-book"></i> <span>Обзор</span></a></li>
            <li><a href="index.php?np=new_kontrakt"><i class="fa fa-plus"></i> <span>Добавить Контракт</span></a></li>
        </ul>
    </li>
    <li><a id="Myunidf" href="index.html"><i class="fa fa-sign-out"></i> <span>Выход</span></a></li>

</ul>

{% endblock %}
{% block content %}
            <div class="row" ><div id="datatbl" class="col-lg-12"></div> </div>
          {% endblock %}
{% block customjs %}

<script charset="utf-8" type="text/javascript">

    webix.ready(function(){
        var selectedid;

        webix.ui({
            container: 'datatbl',
            view: "datatable",
            id: 'datatable',
            onContext:{},
            columns: [
                { id: 'name',fillspace:true, header: ["Наименование учереждения", {content: 'textFilter'}], width: 300, sort: 'string'},
                { id: 'put',header:"Количество путевок", width: 150, sort: 'int'},
                { id: 'price', header: "Цена контракта", width: 150, sort: 'int'},
                { id: 'days', header: "Дней &nbsp;прибывания", width: 150, sort: 'int'},
                { id: 'date', header: ["Дата контракта", {content: 'textFilter'}], width: 150, sort: 'string',
                    format: webix.Date.dateToStr('%Y-%m-%d')}],
               url: 'select/get_all_kontrakt.php',height:550, select: 'row',scrollX:false, on:{
               onBeforeLoad:function(){
                   this.showOverlay('Загрузка...');
               },onSelectChange:function(){
                 var selectedid = $$('datatable').getSelectedId(true).join();
                 document.location.href = "index.php?np=contraktprofile&id="+selectedid;
               },
               onAfterLoad:function(){
                   if (!this.count())
                       this.showOverlay('обновите старницу');
                   else
                       this.hideOverlay();
               }
        }});

       webix.ui({
            view:"contextmenu",
            id:"cmenu",
            data:["Просмотреть","Удалить"],
            on:{
                onItemClick:function(id){
                    var context = this.getContext();
                    if(this.getItem(id).id=="Просмотреть")
                    document.location.href = "index.php?np=contraktprofile&id="+context.id;
                    //delete
                    if(this.getItem(id).id=="Удалить"){
                        webix.ajax("delete/deletefromkontrakt.php?id="+context.id);
                        $$("datatable").remove(context.id);
                    }

                }
            }
        });

        $$("cmenu").attachTo($$("datatable"));

    });

</script>
{% endblock %}
