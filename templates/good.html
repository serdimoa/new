{% extends "base.html" %}

{% block title %}Просмотр всех детей{% endblock %}

{% block nav %}
<ul class="nav nav-pills nav-stacked custom-nav">
    <li class="menu-list nav-active"><a href=""><i class="fa fa-home"></i> <span>Реестр детей</span></a>
        <ul class="sub-menu-list">
            <li class="active"><a href="index.php?np=good"><i class="fa fa-search"></i> <span>Обзор</span></a></li>
            <li><a href="index.php?np=children_new"><i class="fa fa-plus"></i> <span>Добавить ребенка</span></a></li>
        </ul>
    </li>
    <li><a href="index.php?np=request"><i class="fa fa-envelope"></i> <span>Реестр заявок</span></a></li>
    <li class="menu-list "><a href=""><i class="fa fa-home"></i> <span>Контракты</span></a>
        <ul class="sub-menu-list">
            <li> <a href="index.php?np=kontrakt"><i class="fa fa-book"></i> <span>Обзор</span></a></li>
            <li><a href="index.php?np=new_kontrakt"><i class="fa fa-plus"></i> <span>Добавить Контракт</span></a></li>
        </ul>
    </li>
    <li><a id="Myunidf" href="index.html"><i class="fa fa-sign-out"></i> <span>Выход</span></a></li>

</ul>
{% endblock %}







{% block content %}
<header class="panel-heading custom-tab dark-tab">
  <ul class="nav nav-tabs">
    <li class="active">
      <a href="#home2" data-toggle="tab">Реестр детей</a>
    </li>
    <li class="">
      <a href="#contact2" data-toggle="tab">Заявки для выбраного ребенка</a>
    </li>

  </ul>
</header>
<div class="panel-body col-lg-12">
  <div class="tab-content">
    <div class="tab-pane active" id="home2">
      <div class="row" ><div id="datatbl" class="col-lg-12"></div>
  </div>
    </div>
    <div class="tab-pane" id="contact2">
      <div class="row" ><div id="datatblinfo" class="col-lg-12"></div>

 </div><br>
 <a class="btn btn-info btn-lg " onclick="showld()" href="#">Просмотр личного дела</a>

    </div>

  </div>
</div>




{% endblock %}
{% block customjs %}
<script charset="utf-8" type="text/javascript">
webix.ready(function(){
    var selectedid;

    webix.ui({
        container: 'datatbl',
        view: "datatable",
        id: 'datatable',
        onContext:{},
        columns: [
            { id: 'firstname',fillspace:true, header: ['Фамилия', {content: 'textFilter'}], width: 300, sort: 'string'},
            { id: 'name',fillspace:true, header: ['Имя', {content: 'textFilter'}], width: 300, sort: 'string'},
            { id: 'surname',fillspace:true, header: ['Отчество', {content: 'textFilter'}], width: 300, sort: 'string'},
            { id: 'event', header: "Вид отдыха", width: 80, sort: 'int'},
            { id: 'date', header: ['Дата рождения', {content: 'textFilter'}], width: 100, sort: 'string',
                format: webix.Date.dateToStr('%Y-%m-%d')}],
           url: 'select/get_all.php',height:550, select: 'row',scrollX:false, on:{
           onBeforeLoad:function(){
               this.showOverlay('Загрузка...');
           },
           onAfterLoad:function(){
               if (!this.count())
                   this.showOverlay('обновите старницу');
               else
                   this.hideOverlay();
           },onSelectChange:function(id){
               selectedid = $$('datatable').getSelectedId(true).join();
                $$('datatable1').clearAll();
                $('.nav-tabs a[href="#' + "contact2" + '"]').tab('show');
                $$('datatable1').load('select/putevka.php?ides='+selectedid);



           }
       }
    });

   webix.ui({
        view:"contextmenu",
        id:"cmenu",
        data:["Просмотреть","Удалить"],
        on:{
            onItemClick:function(id){
                var context = this.getContext();
                if(this.getItem(id).id=="Просмотреть")
                document.location.href = "index.php?np=profile&id="+context.id;
                //delete
                if(this.getItem(id).id=="Удалить"){
                    webix.ajax("delete/deletefromgood.php?id="+context.id);
                    $$("datatable").remove(context.id);
                }

            }
        }
    });
    webix.ui({
        container:'datatblinfo',
        view:'datatable',
        id:'datatable1',
        minHeight:200,
        autowidth:true,
        columns:[
            {id:'id',header:'№'},
            {id:'status',header:'Статус',template:function(obj){
                switch (obj.status){
                    case "1":
                        return "В очереди";
                        break;
                    case "2":
                        return "Принято";
                        break;
                    case "3":
                        return "Отказано";
                        break;
                    case "4":
                        return "Исполнено";
                        break;
                    default :
                        return "В очереди";
                        break;
                }
            }},
            {id:'year',header:'Год'},
            {id:'date',header:"Дата&nbsp;подачи",width:200,format: webix.Date.dateToStr('%Y-%m-%d')},
            {id:'type',header:'Направление', width:200,fillspace:true,template:function(obj){
                switch (obj.type){
                    case "1":
                        return "Лагеря с дневным пребыванием детей";
                        break;
                    case "2":
                        return "Лагеря труда и отдыха";
                        break;
                    case "4":
                        return "Лагеря палаточного типа";
                        break;
                    case "5":
                        return "Ханты-Мансийский автономный округ-Югра";
                        break;
                    case "6":
                        return "Тюменская область";
                        break;
                    case "7":
                        return "Свердловская область";
                        break;
                    case "8":
                        return "Краснодарский край г.Анапа";
                        break;
                    case "9":
                        return "Республика Адыгея";
                        break;
                    case "10":
                        return "Республика Болгария";
                        break;
                    default :
                        return "Заполнено не правильно";
                        break;

                }
            }},
            {id:'time',header:'Время&nbsp;отдыха',width:200,template:function(obj){
                switch (obj.time){
                    case "1":
                        return "Весенние каникулы";
                        break;
                    case "2":
                        return "Летние каникулы";
                        break;
                    case "3":
                        return "Осенние каникулы";
                        break;
                    case "4":
                        return "Зимние каникулы";
                        break;
                    default :
                        return "Заполнено не правильно";
                        break;

                }
            }
            },
            {id:'timeobj',header:'Смена',template:function(obj){
                switch (obj.timeobj){
                    case "1":
                        return "1 Смена";
                        break;
                    case "2":
                        return "2 Смена";
                        break;
                    case "3":
                        return "3 Смена";
                        break;
                    case "4":
                        return "4 Смена";
                        break;
                    default :
                        return " ";
                        break;

                }
            }
            }

        ]

    });
    $$("cmenu").attachTo($$("datatable"));


});
function showld(){
  selectedid = $$('datatable').getSelectedId(true).join();
  document.location.href = "index.php?np=profile&id="+selectedid;

}

</script>
{% endblock %}
